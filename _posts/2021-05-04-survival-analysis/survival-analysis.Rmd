---
title: "Survival Analysis"
description: |
  This is a note to myself on survival analysis. You are welcome to use the information. 
author:
  - name: WenYao, Mak 
    url: https://www.linkedin.com/in/mak-wen-yao-51148154/
date: 05-04-2021
output:
  distill::distill_article:
    self_contained: false
    toc: true
    toc_float: true
    number_sections: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Comprehensive Survival Analysis in R

The article introduces different analysis methods for time-to-event data, and how to conduct these analyses using R. 

My current research interest revolves around peritoneal dialysis and related issues, so examples will be illustrated using data in this field.

# Part 1: Survival vs Hazard Functions (Probabilities) 

We often are interested in how long a person can undergo peritoneal dialysis (PD) without suffering infections to their peritoneum (which causes inflamation, i.e. peritonitis). 

The probability that a person can stay peritonitis-free, or *survive* the time from the start of PD treatment to a specific time *t* in the future, is the *survival probability*. This is represented by the *survivor function* **S(t)**, as below: 

$$S(t)=Pr(T>t)$$
The function indicates the population probability of surviving beyond time *t*. 

## Graphical representation of the survival function 

The survival function can be depicted as a *survival curve*. This is more intuitive to understand the probability of surviving (or in our case, remain peritonitis-free) beyond a certain time *t*. 

```{r, echo=F, warning=F, cache=T}
library(tidyverse) 
library(survival)
library(survminer)

kaplan<- tibble(
  id = c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20),
  time = c(100,165,493,86,1804,218,571,389,1645,827,318,833,127,1169,254,1560,129,32,38,100), 
  event = c(0,0,1,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0), 
  sex = c(2,1,1,2,2,1,1,1,2,2,1.,2,1,1,1,2,2,1,2,2))

fit <- survfit(Surv(time, event)~sex, data = kaplan)
print(fit)

ggsurvplot(fit,
          pval = TRUE, conf.int = TRUE,
          risk.table = TRUE, 
          risk.table.col = "strata", 
          linetype = "strata",
          surv.median.line = "hv",
          ggtheme = theme_bw())
```

